{"ast":null,"code":"import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import axios from\"axios\";import{useHistory}from\"react-router-dom\";import{Table,Button}from\"antd\";import useAuthorize from\"../../../utils/authorization\";import{CSVLink}from\"react-csv\";import\"./GestorEntregas.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function GestorEntregas(){var _user$sede;var _useState=useState(),_useState2=_slicedToArray(_useState,2),entregas=_useState2[0],setEntregas=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),form=_useState4[0],setForm=_useState4[1];var user=useSelector(function(state){return state.user;});var history=useHistory();useEffect(function(){axios.get(\"/api/entregas/sede/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});},[user]);useAuthorize(user,2);var handleClick=function handleClick(id){history.push(\"/gestor/entregas/\".concat(id));};var handleChange=function handleChange(e){if(e.target.value==='completadas'){axios.get(\"/api/entregas/completadas/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}if(e.target.value===\"pendientes\"){axios.get(\"/api/entregas/pendientes/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}if(e.target.value===\"todas\"){axios.get(\"/api/entregas/sede/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}};var handleInput=function handleInput(e){setForm(e.target.value);};var handleSubmit=function handleSubmit(e){e.preventDefault();axios.post(\"/api/entregas/user/nombre\",{nombre:form,sedeId:user.sedeId}).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});};var date=function date(entrega){var fecha=entrega.slice(0,10);var fechaCorrecta=\"\".concat(fecha.slice(8,10),\"/\").concat(fecha.slice(5,7),\"/\").concat(fecha.slice(0,4));return fechaCorrecta;};var dataSource=entregas===null||entregas===void 0?void 0:entregas.map(function(entrega){return{key:entrega.id,voluntario:entrega.user.full_name,bloque:entrega.bloque.titulo,estado:entrega.aprobado?\"Completado\":\"Pendiente\",fecha:date(entrega.updatedAt)};});var columns=[{title:\"Voluntario\",render:function render(record){return/*#__PURE__*/_jsxs(React.Fragment,{children:[record.voluntario,/*#__PURE__*/_jsx(\"hr\",{}),record.estado]});},responsive:[\"xs\"]},{title:\"Bloque\",render:function render(record){return/*#__PURE__*/_jsx(React.Fragment,{children:record.bloque});},responsive:[\"xs\"]},{title:\"Voluntario\",dataIndex:\"voluntario\",key:\"voluntario\",responsive:[\"sm\"]},{title:\"Bloque\",dataIndex:\"bloque\",key:\"bloque\",responsive:[\"sm\"]},{title:\"Estado\",dataIndex:\"estado\",key:\"estado\",responsive:[\"sm\"]},{title:\"Fecha\",dataIndex:\"fecha\",key:\"fecha\",responsive:[\"sm\"]},{title:\"\",key:\"ver\",render:function render(text,record){return/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:function onClick(){return handleClick(record.key);},children:\"Ver mas\"});}}];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-3 text-secondary p-5 text-center gestor-entregas\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Entregas de voluntarios\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-around my-4 botones\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:dataSource&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success descargar\",children:/*#__PURE__*/_jsx(CSVLink,{data:dataSource,filename:\"entregas-\".concat((_user$sede=user.sede)===null||_user$sede===void 0?void 0:_user$sede.nombre,\".csv\"),children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-light m-0 fs-5\",children:[\"Descargar \",/*#__PURE__*/_jsx(\"i\",{class:\"bi bi-file-earmark-excel-fill\"})]})})})}),/*#__PURE__*/_jsxs(\"form\",{className:\"row g-0\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"nombre\",onChange:handleInput,className:\"form-control fs-5 busqueda\",placeholder:\"voluntari@s\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary fs-5\",type:\"submit\",children:\"Buscar\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsxs(\"select\",{onChange:handleChange,className:\"form-select fs-5\",children:[/*#__PURE__*/_jsx(\"option\",{children:\"Filtrar por estado\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completadas\",children:\"Completadas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pendientes\",children:\"Pendientes\"}),/*#__PURE__*/_jsx(\"option\",{value:\"todas\",children:\"Todas\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table\",children:/*#__PURE__*/_jsx(Table,{bordered:true,dataSource:dataSource,columns:columns,pagination:true})})]});}","map":null,"metadata":{},"sourceType":"module"}