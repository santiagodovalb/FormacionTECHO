{"ast":null,"code":"import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{useSelector}from\"react-redux\";import{useLocation}from\"react-router-dom\";import Swal from\"sweetalert2\";import{Select,message}from\"antd\";import\"./AdminUsers.css\";import useAuthorize from\"../../../utils/authorization\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Option=Select.Option;function Users(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),rol=_useState2[0],setRol=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),users=_useState4[0],setUsers=_useState4[1];var user=useSelector(function(state){return state.user;});var roles=useSelector(function(state){return state.roles.filter(function(rol){return rol.id!==1;});});var location=useLocation();var id=location.pathname.slice(21);useEffect(function(){axios.get(\"/api/users/sede/\".concat(id)).then(function(res){return res.data;}).then(function(users){return setUsers(users);});},[user,id]);var handleChange=function handleChange(e){setRol(e);};var handleClick=function handleClick(userId,rolId){axios.post(\"/api/roles/set/\",{userId:userId,rolId:rolId,user:user}).then(function(){return axios.get(\"/api/users/sede/\".concat(id));}).then(function(res){return res.data;}).then(function(users){return setUsers(users);});};var alertaEliminar=Swal.mixin({buttonsStyling:true});var handleDelete=function handleDelete(userId){alertaEliminar.fire({title:\"Estás seguro?\",text:\"Si lo confirmas, no podrás deshacerlo!\",icon:\"warning\",showCancelButton:true,confirmButtonText:\"Si, borrar!\",cancelButtonText:\"No, cancelar!\",confirmButtonColor:\"#3085d6\",cancelButtonColor:\"#d33\",reverseButtons:true}).then(function(result){if(result.isConfirmed){alertaEliminar.fire(\"Eliminado!\",\"El usuario fue eliminado correctamente.\",\"success\");axios.delete(\"/api/users/\".concat(userId)).then(function(){return axios.get(\"/api/users/sede/\".concat(id)).then(function(res){return res.data;}).then(function(users){return setUsers(users);});});message.success(\"Usuario eliminado correctamente\");}else if(result.dismiss===Swal.DismissReason.cancel){alertaEliminar.fire(\"Cancelado\",\"El usuario está a salvo\",\"error\");}});};useAuthorize(user,1);return/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Administrar roles\"})}),!users.length&&/*#__PURE__*/_jsx(\"h1\",{className:\"fs-4\",children:\"No hay voluntarios/gestores en esta sede\"}),/*#__PURE__*/_jsx(\"br\",{}),users&&users.map(function(user){return/*#__PURE__*/_jsxs(\"div\",{className:\"divAdminUser\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"fs-6\",children:[\"Nombre: \",\"  \",/*#__PURE__*/_jsx(\"strong\",{children:user.full_name})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"fs-6\",children:[\"Rol: \",\"  \",/*#__PURE__*/_jsx(\"strong\",{children:user.rol&&user.rol.tipo})]}),/*#__PURE__*/_jsx(Select,{style:{width:200},placeholder:\"Seleccionar rol\",onChange:handleChange,children:roles&&roles.map(function(rol){return/*#__PURE__*/_jsxs(Option,{label:\"children\",value:rol.id,children:[\" \",rol.tipo,\" \"]},rol.id);})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary mx-1\",onClick:function onClick(){return handleClick(user.id,parseInt(rol));},type:\"button\",children:\"Asignar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-danger mx-1\",onClick:function onClick(){return handleDelete(user.id);},type:\"button\",children:\"Eliminar usuario\"})]},user.id);})]});}export default Users;","map":{"version":3,"sources":["/home/santi/P5/TECHO/formacion-techo/src/containers/Admin/AdminUsers/Users.jsx"],"names":["React","useState","useEffect","axios","useSelector","useLocation","Swal","Select","message","useAuthorize","Option","Users","rol","setRol","users","setUsers","user","state","roles","filter","id","location","pathname","slice","get","then","res","data","handleChange","e","handleClick","userId","rolId","post","alertaEliminar","mixin","buttonsStyling","handleDelete","fire","title","text","icon","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","cancelButtonColor","reverseButtons","result","isConfirmed","delete","success","dismiss","DismissReason","cancel","length","map","full_name","tipo","width","parseInt"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { useLocation } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport { Select, message } from \"antd\";\nimport \"./AdminUsers.css\";\nimport useAuthorize from \"../../../utils/authorization\";\n\nconst { Option } = Select;\n\nfunction Users() {\n  const [rol, setRol] = useState(0);\n  const [users, setUsers] = useState([]);\n  const user = useSelector((state) => state.user);\n  const roles = useSelector((state) =>\n    state.roles.filter((rol) => rol.id !== 1)\n  );\n  const location = useLocation();\n  const id = location.pathname.slice(21);\n\n  useEffect(() => {\n    axios\n      .get(`/api/users/sede/${id}`)\n      .then((res) => res.data)\n      .then((users) => setUsers(users));\n  }, [user, id]);\n\n  const handleChange = (e) => {\n    setRol(e);\n  };\n\n  const handleClick = (userId, rolId) => {\n    axios\n      .post(\"/api/roles/set/\", { userId, rolId, user })\n      .then(() => axios.get(`/api/users/sede/${id}`))\n      .then((res) => res.data)\n      .then((users) => setUsers(users));\n  };\n  const alertaEliminar = Swal.mixin({\n    buttonsStyling: true,\n  });\n\n  const handleDelete = (userId) => {\n    alertaEliminar\n      .fire({\n        title: \"Estás seguro?\",\n        text: \"Si lo confirmas, no podrás deshacerlo!\",\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Si, borrar!\",\n        cancelButtonText: \"No, cancelar!\",\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        reverseButtons: true,\n      })\n      .then((result) => {\n        if (result.isConfirmed) {\n          alertaEliminar.fire(\n            \"Eliminado!\",\n            \"El usuario fue eliminado correctamente.\",\n            \"success\"\n          );\n          axios.delete(`/api/users/${userId}`).then(() =>\n            axios\n              .get(`/api/users/sede/${id}`)\n              .then((res) => res.data)\n              .then((users) => setUsers(users))\n          );\n          message.success(\"Usuario eliminado correctamente\");\n        } else if (result.dismiss === Swal.DismissReason.cancel) {\n          alertaEliminar.fire(\"Cancelado\", \"El usuario está a salvo\", \"error\");\n        }\n      });\n  };\n\n  useAuthorize(user, 1);\n\n  return (\n    <div className=\"admin\">\n      <h1 className=\"fs-2 text-secondary\">\n        <strong>Administrar roles</strong>\n      </h1>\n      {!users.length && (\n        <h1 className=\"fs-4\">No hay voluntarios/gestores en esta sede</h1>\n      )}\n      <br />\n\n      {users &&\n        users.map((user) => {\n          return (\n            <div className=\"divAdminUser\" key={user.id}>\n              <p className=\"fs-6\">\n                Nombre: {\"  \"}\n                <strong>{user.full_name}</strong>\n              </p>\n              <p className=\"fs-6\">\n                Rol: {\"  \"}\n                <strong>{user.rol && user.rol.tipo}</strong>\n              </p>\n\n              <Select\n                style={{ width: 200 }}\n                placeholder=\"Seleccionar rol\"\n                onChange={handleChange}\n              >\n                {roles &&\n                  roles.map((rol) => {\n                    return (\n                      <Option key={rol.id} label=\"children\" value={rol.id}>\n                        {\" \"}\n                        {rol.tipo}{\" \"}\n                      </Option>\n                    );\n                  })}\n              </Select>\n              <button\n                className=\"btn btn-outline-primary mx-1\"\n                onClick={() => handleClick(user.id, parseInt(rol))}\n                type=\"button\"\n              >\n                Asignar\n              </button>\n              <button\n                className=\"btn btn-outline-danger mx-1\"\n                onClick={() => handleDelete(user.id)}\n                type=\"button\"\n              >\n                Eliminar usuario\n              </button>\n            </div>\n          );\n        })}\n    </div>\n  );\n}\n\nexport default Users;\n"]},"metadata":{},"sourceType":"module"}