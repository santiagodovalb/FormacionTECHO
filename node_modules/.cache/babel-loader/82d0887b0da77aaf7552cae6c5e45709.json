{"ast":null,"code":"import _toConsumableArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useHistory,useParams}from\"react-router-dom\";import{Form,Input,Radio,message}from\"antd\";import Swal from\"sweetalert2\";import{getBloques}from\"../../../redux/bloques\";import AdminUnidades from\"../AdminUnidades/AdminUnidades.jsx\";import Unidades from\"./Unidades.jsx\";import useAuthorize from\"../../../utils/authorization\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ModificarBloque(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),count=_useState2[0],setCount=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),bloque=_useState4[0],setBloque=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showForm=_useState6[0],setShowForm=_useState6[1];var _useState7=useState({bloque:bloque}),_useState8=_slicedToArray(_useState7,2),form=_useState8[0],setForm=_useState8[1];var _useParams=useParams(),id=_useParams.id;var user=useSelector(function(state){return state.user;});var roles=useSelector(function(state){return state.roles;}).filter(function(rol){return rol.id>2;});var history=useHistory();var dispatch=useDispatch();useEffect(function(){axios.get(\"/api/bloques/\".concat(id)).then(function(res){return res.data;}).then(function(bloque){setForm({titulo:bloque.titulo,descripcion:bloque.descripcion,minimo:bloque.minimo,rolesId:bloque.roles.map(function(rol){return rol.id;})});setBloque(bloque);return bloque;}).then(function(bloque){var rolesIds=roles.map(function(rol){return rol.id;});for(var i=0;i<roles.length;i++){document.getElementById(\"rol\".concat(rolesIds[i])).checked=bloque.roles.map(function(rol){return rol.id;}).includes(rolesIds[i])&&\"true\";}document.getElementById(\"minimoSi\").checked=bloque.minimo&&\"true\";document.getElementById(\"minimoNo\").checked=!bloque.minimo&&\"true\";});},[showForm,count,user,id]);var handleChange=function handleChange(e){setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},e.target.name,e.target.value)));};var handleMinimo=function handleMinimo(e){var boolean=e.target.id===\"si\"?true:false;setForm(_objectSpread(_objectSpread({},form),{},{minimo:boolean}));};var handleRoles=function handleRoles(e){var array=_toConsumableArray(form.rolesId);e.target.checked?array=[].concat(_toConsumableArray(array),[e.target.value]):array.splice(form.rolesId.indexOf(e.target.value),1);setForm(_objectSpread(_objectSpread({},form),{},{rolesId:_toConsumableArray(array)}));};var handleSubmit=function handleSubmit(){axios.put(\"/api/bloques/\".concat(id),form).then(function(){dispatch(getBloques());}).then(function(){message.success(\"Modificado correctamente\");history.push(\"/admin-bloques\");});};var alertaEliminar=Swal.mixin({buttonsStyling:true});var handleDelete=function handleDelete(){alertaEliminar.fire({title:\"Estás seguro?\",text:\"Si lo confirmas, no podrás deshacerlo!\",icon:\"warning\",showCancelButton:true,confirmButtonText:\"Si, borrar!\",cancelButtonText:\"No, cancelar!\",confirmButtonColor:\"#3085d6\",cancelButtonColor:\"#d33\",reverseButtons:true}).then(function(result){if(result.isConfirmed){alertaEliminar.fire(\"Eliminado!\",\"El bloque fue eliminado correctamente.\",\"success\");axios.delete(\"/api/bloques/\".concat(id)).then(function(){dispatch(getBloques());history.push(\"/admin-bloques\");});}else if(result.dismiss===Swal.DismissReason.cancel){alertaEliminar.fire(\"Cancelado\",\"El bloque está a salvo\",\"error\");}});};var toggleUnidad=function toggleUnidad(){setShowForm(!showForm);};var forceRender=function forceRender(){setCount(count+1);};useAuthorize(user,1);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary m-5\",children:/*#__PURE__*/_jsx(\"strong\",{children:bloque&&bloque.titulo})}),/*#__PURE__*/_jsx(\"br\",{})]}),bloque&&/*#__PURE__*/_jsxs(Form,{labelCol:{span:5},wrapperCol:{span:13},onFinish:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Item,{label:\"Titulo\",children:/*#__PURE__*/_jsx(Input,{className:\"admin_input\",type:\"text\",name:\"titulo\",onChange:handleChange,defaultValue:bloque.titulo})}),/*#__PURE__*/_jsx(Form.Item,{label:\"Descripci\\xF3n\",children:/*#__PURE__*/_jsx(Input.TextArea,{defaultValue:bloque.descripcion,autoSize:true,name:\"descripcion\",className:\"admin_input\",showCount:true,maxLength:350,onChange:handleChange})}),/*#__PURE__*/_jsx(Form.Item,{label:\"Preguntas\",children:/*#__PURE__*/_jsx(Input.TextArea,{className:\"admin_input\",onChange:handleChange,name:\"pregunta\",defaultValue:bloque.pregunta})}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\xBFEs bloque m\\xEDnimo?\"}),/*#__PURE__*/_jsxs(Radio.Group,{children:[/*#__PURE__*/_jsx(Radio.Button,{id:\"minimoSi\",value:true,onChange:handleMinimo,children:\"Si\"}),/*#__PURE__*/_jsx(Radio.Button,{id:\"minimoNo\",value:false,onChange:handleMinimo,children:\"No\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h5\",{children:\"\\xBFA qu\\xE9 roles est\\xE1 destinado?\"}),roles.map(function(rol){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"admin_check\",htmlFor:rol.tipo,children:rol.tipo}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"roles\",value:rol.id,id:\"rol\".concat(rol.id),onChange:handleRoles})]},rol.id);})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-danger m-4 px-3 fs-4\",type:\"button\",onClick:handleDelete,children:\"Eliminar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary m-4 px-3 fs-4\",type:\"submit\",children:\"Modificar\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"my-5 d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"mb-3 mt-3 p-3 fs-4 button-style button-style green\",type:\"button\",onClick:toggleUnidad,style:{display:showForm?\"none\":\"block\"},children:\"Agregar unidad al bloque\"}),showForm&&/*#__PURE__*/_jsx(AdminUnidades,{forceRender:forceRender,bloque:bloque}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Unidades del bloque\"})}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(Unidades,{forceRender:forceRender,unidades:bloque===null||bloque===void 0?void 0:bloque.unidades})]});}","map":{"version":3,"sources":["/home/santi/P5/TECHO/formacion-techo/src/containers/Admin/AdminBloques/ModificarBloque.jsx"],"names":["axios","React","useEffect","useState","useDispatch","useSelector","useHistory","useParams","Form","Input","Radio","message","Swal","getBloques","AdminUnidades","Unidades","useAuthorize","ModificarBloque","count","setCount","bloque","setBloque","showForm","setShowForm","form","setForm","id","user","state","roles","filter","rol","history","dispatch","get","then","res","data","titulo","descripcion","minimo","rolesId","map","rolesIds","i","length","document","getElementById","checked","includes","handleChange","e","target","name","value","handleMinimo","boolean","handleRoles","array","splice","indexOf","handleSubmit","put","success","push","alertaEliminar","mixin","buttonsStyling","handleDelete","fire","title","text","icon","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","cancelButtonColor","reverseButtons","result","isConfirmed","delete","dismiss","DismissReason","cancel","toggleUnidad","forceRender","span","pregunta","tipo","display","unidades"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { Form, Input, Radio, message } from \"antd\";\nimport Swal from \"sweetalert2\";\nimport { getBloques } from \"../../../redux/bloques\";\nimport AdminUnidades from \"../AdminUnidades/AdminUnidades.jsx\";\nimport Unidades from \"./Unidades.jsx\";\nimport useAuthorize from \"../../../utils/authorization\";\n\nexport default function ModificarBloque() {\n  const [count, setCount] = useState(0);\n  const [bloque, setBloque] = useState();\n  const [showForm, setShowForm] = useState(false);\n  const [form, setForm] = useState({ bloque });\n  const { id } = useParams();\n  const user = useSelector((state) => state.user);\n  const roles = useSelector((state) => state.roles).filter((rol) => rol.id > 2);\n  const history = useHistory();\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    axios\n      .get(`/api/bloques/${id}`)\n      .then((res) => res.data)\n      .then((bloque) => {\n        setForm({\n          titulo: bloque.titulo,\n          descripcion: bloque.descripcion,\n          minimo: bloque.minimo,\n          rolesId: bloque.roles.map((rol) => rol.id),\n        });\n        setBloque(bloque);\n\n        return bloque;\n      })\n      .then((bloque) => {\n        const rolesIds = roles.map((rol) => rol.id);\n        for (let i = 0; i < roles.length; i++) {\n          document.getElementById(`rol${rolesIds[i]}`).checked =\n            bloque.roles.map((rol) => rol.id).includes(rolesIds[i]) && \"true\";\n        }\n        document.getElementById(\"minimoSi\").checked = bloque.minimo && \"true\";\n        document.getElementById(\"minimoNo\").checked = !bloque.minimo && \"true\";\n      });\n  }, [showForm, count, user, id]);\n\n  const handleChange = (e) => {\n    setForm({ ...form, [e.target.name]: e.target.value });\n  };\n\n  const handleMinimo = (e) => {\n    let boolean = e.target.id === \"si\" ? true : false;\n    setForm({ ...form, minimo: boolean });\n  };\n\n  const handleRoles = (e) => {\n    let array = [...form.rolesId];\n    e.target.checked\n      ? (array = [...array, e.target.value])\n      : array.splice(form.rolesId.indexOf(e.target.value), 1);\n    setForm({ ...form, rolesId: [...array] });\n  };\n\n  const handleSubmit = () => {\n    axios.put(`/api/bloques/${id}`, form)\n    .then(() => {\n      dispatch(getBloques());\n    })\n    .then(() =>{\n      message.success(\"Modificado correctamente\")\n      history.push(\"/admin-bloques\")\n    })\n  };\n\n  const alertaEliminar = Swal.mixin({\n    buttonsStyling: true,\n  });\n\n  const handleDelete = () => {\n    alertaEliminar\n      .fire({\n        title: \"Estás seguro?\",\n        text: \"Si lo confirmas, no podrás deshacerlo!\",\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"Si, borrar!\",\n        cancelButtonText: \"No, cancelar!\",\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        reverseButtons: true,\n      })\n      .then((result) => {\n        if (result.isConfirmed) {\n          alertaEliminar.fire(\n            \"Eliminado!\",\n            \"El bloque fue eliminado correctamente.\",\n            \"success\"\n          );\n          axios.delete(`/api/bloques/${id}`).then(() => {\n            dispatch(getBloques());\n            history.push(\"/admin-bloques\");\n          });\n        } else if (result.dismiss === Swal.DismissReason.cancel) {\n          alertaEliminar.fire(\"Cancelado\", \"El bloque está a salvo\", \"error\");\n        }\n      });\n  };\n\n  const toggleUnidad = () => {\n    setShowForm(!showForm);\n  };\n\n  const forceRender = () => {\n    setCount(count + 1);\n  };\n\n  useAuthorize(user, 1);\n\n  return (\n    <div>\n      <div className=\"admin\">\n        <h1 className=\"fs-2 text-secondary m-5\">\n          <strong>{bloque && bloque.titulo}</strong>\n        </h1>\n        <br />\n      </div>\n      {bloque && (\n        <Form\n          labelCol={{\n            span: 5,\n          }}\n          wrapperCol={{\n            span: 13,\n          }}\n          onFinish={handleSubmit}\n        >\n          <Form.Item label=\"Titulo\">\n            <Input\n              className=\"admin_input\"\n              type=\"text\"\n              name=\"titulo\"\n              onChange={handleChange}\n              defaultValue={bloque.titulo}\n            ></Input>\n          </Form.Item>\n          <Form.Item label=\"Descripción\">\n            <Input.TextArea\n            defaultValue={bloque.descripcion}\n              autoSize={true}\n              name='descripcion'\n              className=\"admin_input\"\n              showCount\n              maxLength={350}\n              onChange={handleChange}\n            ></Input.TextArea>\n          </Form.Item>\n          <Form.Item  label=\"Preguntas\" >\n            <Input.TextArea\n              className=\"admin_input\"\n              onChange={handleChange}\n              name=\"pregunta\"\n              defaultValue={bloque.pregunta}\n            ></Input.TextArea>\n          </Form.Item>\n\n          <div className=\"admin\">\n            <h5>¿Es bloque mínimo?</h5>\n            <Radio.Group>\n              <Radio.Button id=\"minimoSi\" value={true} onChange={handleMinimo}>\n                Si\n              </Radio.Button>\n              <Radio.Button id=\"minimoNo\" value={false} onChange={handleMinimo}>\n                No\n              </Radio.Button>\n            </Radio.Group>\n            <br />\n            <h5>¿A qué roles está destinado?</h5>\n\n            {roles.map((rol) => {\n              return (\n                <div key={rol.id}>\n                  <label className=\"admin_check\" htmlFor={rol.tipo}>\n                    {rol.tipo}\n                  </label>\n                  <input\n                    type=\"checkbox\"\n                    name=\"roles\"\n                    value={rol.id}\n                    id={`rol${rol.id}`}\n                    onChange={handleRoles}\n                  />\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"d-flex justify-content-center\">\n            <button\n              className=\"btn btn-outline-danger m-4 px-3 fs-4\"\n              type=\"button\"\n              onClick={handleDelete}\n            >\n              Eliminar\n            </button>\n            <button\n              className=\"btn btn-outline-primary m-4 px-3 fs-4\"\n              type=\"submit\"\n            >\n              Modificar\n            </button>\n          </div>\n        </Form>\n      )}\n      <div className=\"my-5 d-flex justify-content-center\">\n        <button\n          className=\"mb-3 mt-3 p-3 fs-4 button-style button-style green\"\n          type=\"button\"\n          onClick={toggleUnidad}\n          style={{ display: showForm ? \"none\" : \"block\" }}\n        >\n          Agregar unidad al bloque\n        </button>\n        {showForm && (\n          <AdminUnidades forceRender={forceRender} bloque={bloque} />\n        )}\n        <br />\n      </div>\n      <div className=\"admin\">\n        <h1 className=\"fs-2 text-secondary\">\n          <strong>Unidades del bloque</strong>\n        </h1>\n        <br />\n      </div>\n      <Unidades forceRender={forceRender} unidades={bloque?.unidades} />\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}