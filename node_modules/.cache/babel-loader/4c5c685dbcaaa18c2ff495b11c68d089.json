{"ast":null,"code":"import _toConsumableArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useSelector}from\"react-redux\";import{Table}from\"antd\";import axios from\"axios\";import useAuthorize from\"../../../utils/authorization\";import{CSVLink}from\"react-csv\";import{minimosCompletados,opcionalesCompletados,minimosTotal,opcionalesTotal}from\"../../Gestor/DashboardGestor/dashUtils\";import\"./DashboardAdmin.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function AdminDashboard(){var user=useSelector(function(state){return state.user;});var sedes=useSelector(function(state){return state.sedes;});var users=useSelector(function(state){return state.users;});var bloques=useSelector(function(state){return state.bloques;});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),voluntarios=_useState2[0],setVoluntarios=_useState2[1];useAuthorize(user,1);useEffect(function(){axios.get('/api/users/entregas').then(function(res){return res.data;}).then(function(voluntarios){return setVoluntarios(voluntarios.filter(function(voluntario){return voluntario.rolId>2;}));}).catch(function(err){return err;});},[user,bloques]);var columns=[{title:\"Sede\",render:function render(record){return/*#__PURE__*/_jsx(React.Fragment,{children:record.sede});},responsive:[\"xs\"]},{title:'',dataIndex:'total',key:'total',responsive:[\"sm\"]},{title:'Sede',dataIndex:'sede',key:'sede',responsive:[\"sm\"]},{title:'Voluntarios',dataIndex:'voluntarios',key:'voluntarios',responsive:[\"sm\"]},{title:'Gestores',dataIndex:'gestores',key:'gestores',responsive:[\"sm\"]},{title:'Bloques mÃ­nimos completados',dataIndex:'minimos',key:'minimos'},{title:'Bloques opcionales completados',dataIndex:'opcionales',key:'opcionales'}];useAuthorize(user,1);useEffect(function(){axios.get(\"/api/users/entregas\").then(function(res){return res.data;}).then(function(voluntarios){return setVoluntarios(voluntarios.filter(function(voluntario){return voluntario.rolId>2;}));}).catch(function(err){return err;});},[user,bloques]);var dataSource2=sedes.map(function(sede){var usuarios=users.filter(function(user){return user.sedeId===sede.id;});var minimosCompletos=0;var totalMinimos=0;var opcionalesCompletos=0;var totalOpcionales=0;var voluntariosDeSede=voluntarios.filter(function(voluntario){return voluntario.sedeId===sede.id;});voluntariosDeSede.forEach(function(voluntarioDeSede){return minimosCompletos=minimosCompletos+minimosCompletados(voluntarioDeSede);});voluntariosDeSede.forEach(function(voluntarioDeSede){return opcionalesCompletos=opcionalesCompletos+opcionalesCompletados(voluntarioDeSede);});voluntariosDeSede.forEach(function(voluntarioDeSede){return totalMinimos=totalMinimos+minimosTotal(voluntarioDeSede,bloques);});voluntariosDeSede.forEach(function(voluntarioDeSede){return totalOpcionales=totalOpcionales+opcionalesTotal(voluntarioDeSede,bloques);});return{key:sede.id,total:\"\",sede:sede.nombre,voluntarios:usuarios.filter(function(user){return user.rolId>2;}).length,gestores:usuarios.filter(function(user){return user.rolId===2;}).length,minimos:\"\".concat(minimosCompletos,\"/\").concat(totalMinimos),opcionales:\"\".concat(opcionalesCompletos,\"/\").concat(totalOpcionales)};});var totalMinimoCompletado=function totalMinimoCompletado(){var total=0;voluntarios.forEach(function(voluntario){return total=total+minimosCompletados(voluntario);});return total;};var totalOpcionalCompletado=function totalOpcionalCompletado(){var total=0;voluntarios.forEach(function(voluntario){return total=total+opcionalesCompletados(voluntario);});return total;};var totalMinimo=function totalMinimo(){var total=0;voluntarios.forEach(function(voluntario){return total=total+minimosTotal(voluntario,bloques);});return total;};var totalOpcional=function totalOpcional(){var total=0;voluntarios.forEach(function(voluntario){return total=total+opcionalesTotal(voluntario,bloques);});return total;};var dataSource=[].concat(_toConsumableArray(dataSource2),[{key:\"total\",total:\"Total\",sede:sedes.length,voluntarios:users.filter(function(user){return user.rolId>2;}).length,gestores:users.filter(function(user){return user.rolId===2;}).length,minimos:\"\".concat(totalMinimoCompletado(),\"/\").concat(totalMinimo()),opcionales:\"\".concat(totalOpcionalCompletado(),\"/\").concat(totalOpcional())}]);return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary p-5\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Dashboard Nacional\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center\",children:dataSource&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success my-3 fs-5\",children:/*#__PURE__*/_jsx(CSVLink,{data:dataSource,filename:\"dashboard-nacional.csv\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-light m-0\",children:[\"Descargar \",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-file-earmark-excel-fill\"})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"table\",children:/*#__PURE__*/_jsx(Table,{bordered:true,dataSource:dataSource,columns:columns,pagination:false})})]});}","map":null,"metadata":{},"sourceType":"module"}