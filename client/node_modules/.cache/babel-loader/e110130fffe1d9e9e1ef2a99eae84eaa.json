{"ast":null,"code":"import _toConsumableArray from\"/home/santi/P5/TECHO/formacion-techo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/santi/P5/TECHO/formacion-techo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/santi/P5/TECHO/formacion-techo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from\"axios\";import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useHistory,useParams}from\"react-router-dom\";import{Form,Input,Radio,message}from\"antd\";import Swal from\"sweetalert2\";import{getBloques}from\"../../../redux/bloques\";import AdminUnidades from\"../AdminUnidades/AdminUnidades.jsx\";import Unidades from\"./Unidades.jsx\";import useAuthorize from\"../../../utils/authorization\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ModificarBloque(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),count=_useState2[0],setCount=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),bloque=_useState4[0],setBloque=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showForm=_useState6[0],setShowForm=_useState6[1];var _useState7=useState({bloque:bloque}),_useState8=_slicedToArray(_useState7,2),form=_useState8[0],setForm=_useState8[1];var _useParams=useParams(),id=_useParams.id;var user=useSelector(function(state){return state.user;});var roles=useSelector(function(state){return state.roles;}).filter(function(rol){return rol.id>2;});var history=useHistory();var dispatch=useDispatch();useEffect(function(){axios.get(\"/api/bloques/\".concat(id)).then(function(res){return res.data;}).then(function(bloque){setForm({titulo:bloque.titulo,descripcion:bloque.descripcion,minimo:bloque.minimo,rolesId:bloque.roles.map(function(rol){return rol.id;})});setBloque(bloque);return bloque;}).then(function(bloque){var rolesIds=roles.map(function(rol){return rol.id;});for(var i=0;i<roles.length;i++){document.getElementById(\"rol\".concat(rolesIds[i])).checked=bloque.roles.map(function(rol){return rol.id;}).includes(rolesIds[i])&&\"true\";}document.getElementById(\"minimoSi\").checked=bloque.minimo&&\"true\";document.getElementById(\"minimoNo\").checked=!bloque.minimo&&\"true\";});},[showForm,count,user,id]);var handleChange=function handleChange(e){setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},e.target.name,e.target.value)));};var handleMinimo=function handleMinimo(e){var boolean=e.target.id===\"si\"?true:false;setForm(_objectSpread(_objectSpread({},form),{},{minimo:boolean}));};var handleRoles=function handleRoles(e){var array=_toConsumableArray(form.rolesId);e.target.checked?array=[].concat(_toConsumableArray(array),[e.target.value]):array.splice(form.rolesId.indexOf(e.target.value),1);setForm(_objectSpread(_objectSpread({},form),{},{rolesId:_toConsumableArray(array)}));};var handleSubmit=function handleSubmit(){axios.put(\"/api/bloques/\".concat(id),form).then(function(){dispatch(getBloques());}).then(function(){message.success(\"Modificado correctamente\");history.push(\"/admin-bloques\");});};var alertaEliminar=Swal.mixin({buttonsStyling:true});var handleDelete=function handleDelete(){alertaEliminar.fire({title:\"Estás seguro?\",text:\"Si lo confirmas, no podrás deshacerlo!\",icon:\"warning\",showCancelButton:true,confirmButtonText:\"Si, borrar!\",cancelButtonText:\"No, cancelar!\",confirmButtonColor:\"#3085d6\",cancelButtonColor:\"#d33\",reverseButtons:true}).then(function(result){if(result.isConfirmed){alertaEliminar.fire(\"Eliminado!\",\"El bloque fue eliminado correctamente.\",\"success\");axios.delete(\"/api/bloques/\".concat(id)).then(function(){dispatch(getBloques());history.push(\"/admin-bloques\");});}else if(result.dismiss===Swal.DismissReason.cancel){alertaEliminar.fire(\"Cancelado\",\"El bloque está a salvo\",\"error\");}});};var toggleUnidad=function toggleUnidad(){setShowForm(!showForm);};var forceRender=function forceRender(){setCount(count+1);};useAuthorize(user,1);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary m-5\",children:/*#__PURE__*/_jsx(\"strong\",{children:bloque&&bloque.titulo})}),/*#__PURE__*/_jsx(\"br\",{})]}),bloque&&/*#__PURE__*/_jsxs(Form,{labelCol:{span:5},wrapperCol:{span:13},onFinish:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Item,{label:\"Titulo\",children:/*#__PURE__*/_jsx(Input,{className:\"admin_input\",type:\"text\",name:\"titulo\",onChange:handleChange,defaultValue:bloque.titulo})}),/*#__PURE__*/_jsx(Form.Item,{label:\"Descripci\\xF3n\",children:/*#__PURE__*/_jsx(Input.TextArea,{defaultValue:bloque.descripcion,autoSize:true,name:\"descripcion\",className:\"admin_input\",showCount:true,maxLength:350,onChange:handleChange})}),/*#__PURE__*/_jsx(Form.Item,{label:\"Preguntas\",children:/*#__PURE__*/_jsx(Input.TextArea,{className:\"admin_input\",onChange:handleChange,name:\"pregunta\",defaultValue:bloque.pregunta})}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\xBFEs bloque m\\xEDnimo?\"}),/*#__PURE__*/_jsxs(Radio.Group,{children:[/*#__PURE__*/_jsx(Radio.Button,{id:\"minimoSi\",value:true,onChange:handleMinimo,children:\"Si\"}),/*#__PURE__*/_jsx(Radio.Button,{id:\"minimoNo\",value:false,onChange:handleMinimo,children:\"No\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"h5\",{children:\"\\xBFA qu\\xE9 roles est\\xE1 destinado?\"}),roles.map(function(rol){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"admin_check\",htmlFor:rol.tipo,children:rol.tipo}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"roles\",value:rol.id,id:\"rol\".concat(rol.id),onChange:handleRoles})]},rol.id);})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-danger m-4 px-3 fs-4\",type:\"button\",onClick:handleDelete,children:\"Eliminar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary m-4 px-3 fs-4\",type:\"submit\",children:\"Modificar\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"my-5 d-flex justify-content-center\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"mb-3 mt-3 p-3 fs-4 button-style button-style green\",type:\"button\",onClick:toggleUnidad,style:{display:showForm?\"none\":\"block\"},children:\"Agregar unidad al bloque\"}),showForm&&/*#__PURE__*/_jsx(AdminUnidades,{forceRender:forceRender,bloque:bloque}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-2 text-secondary\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Unidades del bloque\"})}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(Unidades,{forceRender:forceRender,unidades:bloque===null||bloque===void 0?void 0:bloque.unidades})]});}","map":null,"metadata":{},"sourceType":"module"}