{"ast":null,"code":"import _toConsumableArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import axios from\"axios\";import{Table}from\"antd\";import{CSVLink}from\"react-csv\";import{totalMinimos,totalOpcionales,totalPendientes,minimos,opcionales,pendientes}from\"./dashUtils\";import useAuthorize from\"../../../utils/authorization\";import\"./DashboardGestor.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function DashboardGestor(){var _user$sede,_user$sede2;var user=useSelector(function(state){return state.user;});var bloques=useSelector(function(state){return state.bloques;});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),voluntarios=_useState2[0],setVoluntarios=_useState2[1];useEffect(function(){axios.get(\"/api/users/sede/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(voluntarios){return setVoluntarios(voluntarios.filter(function(voluntario){return voluntario.rolId>2;}));}).catch(function(err){return err;});},[user,bloques]);useAuthorize(user,2);var dataVoluntarios=voluntarios.map(function(voluntario){return{key:voluntario.id,total:\"\",voluntario:voluntario.full_name,bloquesMinimos:minimos(voluntario,bloques),bloquesOpcionales:opcionales(voluntario,bloques),entregasPendientes:pendientes(voluntario)};});var columns=[{title:\"Entregas pendientes por voluntario\",render:function render(record){return/*#__PURE__*/_jsxs(React.Fragment,{children:[record.voluntario,/*#__PURE__*/_jsx(\"br\",{}),record.entregasPendientes]});},responsive:[\"xs\"]},{title:\"\",dataIndex:\"total\",key:\"total\",responsive:[\"xs\"]},{title:\"\",dataIndex:\"total\",key:\"total\",responsive:[\"sm\"]},{title:\"Voluntario\",dataIndex:\"voluntario\",key:\"voluntario\",responsive:[\"sm\"]},{title:\"Bloques mínimos completados\",dataIndex:\"bloquesMinimos\",key:\"bloquesMinimos\",responsive:[\"sm\"]},{title:\"Bloques opcionales completados\",dataIndex:\"bloquesOpcionales\",key:\"bloquesOpcionales\",responsive:[\"sm\"]},{title:\"Entregas pendientes\",dataIndex:\"entregasPendientes\",key:\"entregasPendientes\",responsive:[\"sm\"]}];var dataSource=[].concat(_toConsumableArray(dataVoluntarios),[{key:\"total\",total:\"Total\",voluntario:voluntarios.length,bloquesMinimos:totalMinimos(voluntarios,bloques),bloquesOpcionales:totalOpcionales(voluntarios,bloques),entregasPendientes:totalPendientes(voluntarios)}]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-3 text-secondary p-5 text-center\",children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"Dashboard de \",(_user$sede=user.sede)===null||_user$sede===void 0?void 0:_user$sede.nombre]})}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center\",children:dataSource&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success my-3 fs-5\",children:/*#__PURE__*/_jsx(CSVLink,{data:dataSource,filename:\"dashboard-\".concat((_user$sede2=user.sede)===null||_user$sede2===void 0?void 0:_user$sede2.nombre,\".csv\"),children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-light m-0\",children:[\"Descargar \",/*#__PURE__*/_jsx(\"i\",{class:\"bi bi-file-earmark-excel-fill\"})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"table\",children:/*#__PURE__*/_jsx(Table,{bordered:true,columns:columns,dataSource:dataSource,pagination:true})})]})});}","map":{"version":3,"sources":["/home/santi/P5/TECHO/formacion-techo/client/src/containers/Gestor/DashboardGestor/DashboardGestor.jsx"],"names":["React","useEffect","useState","useSelector","axios","Table","CSVLink","totalMinimos","totalOpcionales","totalPendientes","minimos","opcionales","pendientes","useAuthorize","DashboardGestor","user","state","bloques","voluntarios","setVoluntarios","get","sedeId","then","res","data","filter","voluntario","rolId","catch","err","dataVoluntarios","map","key","id","total","full_name","bloquesMinimos","bloquesOpcionales","entregasPendientes","columns","title","render","record","responsive","dataIndex","dataSource","length","sede","nombre"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport { Table } from \"antd\";\nimport { CSVLink } from \"react-csv\";\nimport {\n  totalMinimos,\n  totalOpcionales,\n  totalPendientes,\n  minimos,\n  opcionales,\n  pendientes,\n} from \"./dashUtils\";\nimport useAuthorize from \"../../../utils/authorization\";\nimport \"./DashboardGestor.css\";\n\nexport default function DashboardGestor() {\n  const user = useSelector((state) => state.user);\n  const bloques = useSelector((state) => state.bloques);\n  const [voluntarios, setVoluntarios] = useState([]);\n\n  useEffect(() => {\n    axios\n      .get(`/api/users/sede/${user.sedeId}`)\n      .then((res) => res.data)\n      .then((voluntarios) =>\n        setVoluntarios(voluntarios.filter((voluntario) => voluntario.rolId > 2))\n      )\n      .catch((err) => err);\n  }, [user, bloques]);\n\n  useAuthorize(user, 2);\n\n  const dataVoluntarios = voluntarios.map((voluntario) => {\n    return {\n      key: voluntario.id,\n      total: \"\",\n      voluntario: voluntario.full_name,\n      bloquesMinimos: minimos(voluntario, bloques),\n      bloquesOpcionales: opcionales(voluntario, bloques),\n      entregasPendientes: pendientes(voluntario),\n    };\n  });\n\n  const columns = [\n    {\n      title: \"Entregas pendientes por voluntario\",\n      render: (record) => (\n        <React.Fragment>\n          {record.voluntario}\n          <br />\n          {record.entregasPendientes}\n        </React.Fragment>\n      ),\n      responsive: [\"xs\"],\n    },\n    {\n      title: \"\",\n      dataIndex: \"total\",\n      key: \"total\",\n      responsive: [\"xs\"],\n    },\n    {\n      title: \"\",\n      dataIndex: \"total\",\n      key: \"total\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Voluntario\",\n      dataIndex: \"voluntario\",\n      key: \"voluntario\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Bloques mínimos completados\",\n      dataIndex: \"bloquesMinimos\",\n      key: \"bloquesMinimos\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Bloques opcionales completados\",\n      dataIndex: \"bloquesOpcionales\",\n      key: \"bloquesOpcionales\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Entregas pendientes\",\n      dataIndex: \"entregasPendientes\",\n      key: \"entregasPendientes\",\n      responsive: [\"sm\"],\n    },\n  ];\n\n  const dataSource = [\n    ...dataVoluntarios,\n    {\n      key: \"total\",\n      total: \"Total\",\n      voluntario: voluntarios.length,\n      bloquesMinimos: totalMinimos(voluntarios, bloques),\n      bloquesOpcionales: totalOpcionales(voluntarios, bloques),\n      entregasPendientes: totalPendientes(voluntarios),\n    },\n  ];\n\n  return (\n    <>\n      <div className=\"dashboard\">\n        <h1 className=\"fs-3 text-secondary p-5 text-center\">\n          <strong>Dashboard de {user.sede?.nombre}</strong>\n        </h1>\n        <div className=\"d-flex justify-content-center\">\n          {dataSource && (\n            <button className=\"btn btn-success my-3 fs-5\">\n              <CSVLink\n                data={dataSource}\n                filename={`dashboard-${user.sede?.nombre}.csv`}\n              >\n                <p className=\"text-light m-0\">\n                  Descargar <i class=\"bi bi-file-earmark-excel-fill\"></i>\n                </p>\n              </CSVLink>\n            </button>\n          )}\n        </div>\n        <div className=\"table\">\n          <Table\n            bordered\n            columns={columns}\n            dataSource={dataSource}\n            pagination={true}\n          />\n        </div>\n      </div>\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}