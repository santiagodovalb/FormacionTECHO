{"ast":null,"code":"import _slicedToArray from\"/home/santi/P5/TECHO/formacion-techo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import axios from\"axios\";import{useHistory}from\"react-router-dom\";import{Table,Button}from\"antd\";import useAuthorize from\"../../../utils/authorization\";import{CSVLink}from\"react-csv\";import\"./GestorEntregas.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function GestorEntregas(){var _user$sede;var _useState=useState(),_useState2=_slicedToArray(_useState,2),entregas=_useState2[0],setEntregas=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),form=_useState4[0],setForm=_useState4[1];var user=useSelector(function(state){return state.user;});var history=useHistory();useEffect(function(){axios.get(\"/api/entregas/sede/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});},[user]);useAuthorize(user,2);var handleClick=function handleClick(id){history.push(\"/gestor/entregas/\".concat(id));};var handleChange=function handleChange(e){if(e.target.value==='completadas'){axios.get(\"/api/entregas/completadas/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}if(e.target.value===\"pendientes\"){axios.get(\"/api/entregas/pendientes/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}if(e.target.value===\"todas\"){axios.get(\"/api/entregas/sede/\".concat(user.sedeId)).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});}};var handleInput=function handleInput(e){setForm(e.target.value);};var handleSubmit=function handleSubmit(e){e.preventDefault();axios.post(\"/api/entregas/user/nombre\",{nombre:form,sedeId:user.sedeId}).then(function(res){return res.data;}).then(function(entregas){return setEntregas(entregas);});};var date=function date(entrega){var fecha=entrega.slice(0,10);var fechaCorrecta=\"\".concat(fecha.slice(8,10),\"/\").concat(fecha.slice(5,7),\"/\").concat(fecha.slice(0,4));return fechaCorrecta;};var dataSource=entregas===null||entregas===void 0?void 0:entregas.map(function(entrega){return{key:entrega.id,voluntario:entrega.user.full_name,bloque:entrega.bloque.titulo,estado:entrega.aprobado?\"Completado\":\"Pendiente\",fecha:date(entrega.updatedAt)};});var columns=[{title:\"Voluntario\",render:function render(record){return/*#__PURE__*/_jsxs(React.Fragment,{children:[record.voluntario,/*#__PURE__*/_jsx(\"hr\",{}),record.estado]});},responsive:[\"xs\"]},{title:\"Bloque\",render:function render(record){return/*#__PURE__*/_jsx(React.Fragment,{children:record.bloque});},responsive:[\"xs\"]},{title:\"Voluntario\",dataIndex:\"voluntario\",key:\"voluntario\",responsive:[\"sm\"]},{title:\"Bloque\",dataIndex:\"bloque\",key:\"bloque\",responsive:[\"sm\"]},{title:\"Estado\",dataIndex:\"estado\",key:\"estado\",responsive:[\"sm\"]},{title:\"Fecha\",dataIndex:\"fecha\",key:\"fecha\",responsive:[\"sm\"]},{title:\"\",key:\"ver\",render:function render(text,record){return/*#__PURE__*/_jsx(Button,{type:\"button\",onClick:function onClick(){return handleClick(record.key);},children:\"Ver mas\"});}}];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"fs-3 text-secondary p-5 text-center gestor-entregas\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Entregas de voluntarios\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-around my-4 botones\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:dataSource&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success descargar\",children:/*#__PURE__*/_jsx(CSVLink,{data:dataSource,filename:\"entregas-\".concat((_user$sede=user.sede)===null||_user$sede===void 0?void 0:_user$sede.nombre,\".csv\"),children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-light m-0 fs-5\",children:[\"Descargar \",/*#__PURE__*/_jsx(\"i\",{class:\"bi bi-file-earmark-excel-fill\"})]})})})}),/*#__PURE__*/_jsxs(\"form\",{className:\"row g-0\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"nombre\",onChange:handleInput,className:\"form-control fs-5 busqueda\",placeholder:\"voluntari@s\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary fs-5\",type:\"submit\",children:\"Buscar\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-auto\",children:/*#__PURE__*/_jsxs(\"select\",{onChange:handleChange,className:\"form-select fs-5\",children:[/*#__PURE__*/_jsx(\"option\",{children:\"Filtrar por estado\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completadas\",children:\"Completadas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pendientes\",children:\"Pendientes\"}),/*#__PURE__*/_jsx(\"option\",{value:\"todas\",children:\"Todas\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table\",children:/*#__PURE__*/_jsx(Table,{bordered:true,dataSource:dataSource,columns:columns,pagination:true})})]});}","map":{"version":3,"sources":["/home/santi/P5/TECHO/formacion-techo/client/src/containers/Gestor/GestorEntregas/GestorEntregas.jsx"],"names":["React","useEffect","useState","useSelector","axios","useHistory","Table","Button","useAuthorize","CSVLink","GestorEntregas","entregas","setEntregas","form","setForm","user","state","history","get","sedeId","then","res","data","handleClick","id","push","handleChange","e","target","value","handleInput","handleSubmit","preventDefault","post","nombre","date","entrega","fecha","slice","fechaCorrecta","dataSource","map","key","voluntario","full_name","bloque","titulo","estado","aprobado","updatedAt","columns","title","render","record","responsive","dataIndex","text","sede"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport { useHistory } from \"react-router-dom\";\nimport { Table, Button } from \"antd\";\nimport useAuthorize from \"../../../utils/authorization\";\nimport { CSVLink } from \"react-csv\";\nimport \"./GestorEntregas.css\";\n\nexport default function GestorEntregas() {\n  const [entregas, setEntregas] = useState();\n  const [form, setForm] = useState(\"\");\n  const user = useSelector((state) => state.user);\n  const history = useHistory();\n\n  useEffect(() => {\n    axios\n      .get(`/api/entregas/sede/${user.sedeId}`)\n      .then((res) => res.data)\n      .then((entregas) => setEntregas(entregas));\n  }, [user]);\n\n  useAuthorize(user, 2);\n\n  const handleClick = (id) => {\n    history.push(`/gestor/entregas/${id}`);\n  };\n\n  const handleChange = (e) => {\n\n    if (e.target.value === 'completadas') {\n      axios.get(`/api/entregas/completadas/${user.sedeId}`)\n      .then(res => res.data)\n      .then(entregas => setEntregas(entregas))\n    }\n\n    if (e.target.value === \"pendientes\") {\n      axios\n        .get(`/api/entregas/pendientes/${user.sedeId}`)\n        .then((res) => res.data)\n        .then((entregas) => setEntregas(entregas));\n    }\n\n    if (e.target.value === \"todas\") {\n      axios\n        .get(`/api/entregas/sede/${user.sedeId}`)\n        .then((res) => res.data)\n        .then((entregas) => setEntregas(entregas));\n    }\n  };\n\n  const handleInput = (e) => {\n    setForm(e.target.value);\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    axios\n      .post(\"/api/entregas/user/nombre\", { nombre: form, sedeId: user.sedeId })\n      .then((res) => res.data)\n      .then((entregas) => setEntregas(entregas));\n  };\n\n  const date = (entrega) => {\n    let fecha = entrega.slice(0, 10);\n    let fechaCorrecta = `${fecha.slice(8, 10)}/${fecha.slice(\n      5,\n      7\n    )}/${fecha.slice(0, 4)}`;\n    return fechaCorrecta;\n  };\n\n  const dataSource = entregas?.map((entrega) => {\n    return {\n      key: entrega.id,\n      voluntario: entrega.user.full_name,\n      bloque: entrega.bloque.titulo,\n      estado: entrega.aprobado ? \"Completado\" : \"Pendiente\",\n      fecha: date(entrega.updatedAt),\n    };\n  });\n\n  const columns = [\n    {\n      title: \"Voluntario\",\n      render: (record) => (\n        <React.Fragment>\n          {record.voluntario}\n          <hr />\n          {record.estado}\n        </React.Fragment>\n      ),\n      responsive: [\"xs\"],\n    },\n    {\n      title: \"Bloque\",\n      render: (record) => <React.Fragment>{record.bloque}</React.Fragment>,\n      responsive: [\"xs\"],\n    },\n    {\n      title: \"Voluntario\",\n      dataIndex: \"voluntario\",\n      key: \"voluntario\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Bloque\",\n      dataIndex: \"bloque\",\n      key: \"bloque\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Estado\",\n      dataIndex: \"estado\",\n      key: \"estado\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"Fecha\",\n      dataIndex: \"fecha\",\n      key: \"fecha\",\n      responsive: [\"sm\"],\n    },\n    {\n      title: \"\",\n      key: \"ver\",\n      render: (text, record) => (\n        <Button type=\"button\" onClick={() => handleClick(record.key)}>\n          Ver mas\n        </Button>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <h1 className=\"fs-3 text-secondary p-5 text-center gestor-entregas\">\n        <strong>Entregas de voluntarios</strong>\n      </h1>\n      <div className=\"d-flex justify-content-around my-4 botones\">\n        <div className=\"col-auto\">\n          {dataSource && (\n            <button className=\"btn btn-success descargar\">\n              <CSVLink\n                data={dataSource}\n                filename={`entregas-${user.sede?.nombre}.csv`}\n              >\n                <p className=\"text-light m-0 fs-5\">\n                  Descargar <i class=\"bi bi-file-earmark-excel-fill\"></i>\n                </p>\n              </CSVLink>\n            </button>\n          )}\n        </div>\n\n        <form className=\"row g-0\" onSubmit={handleSubmit}>\n          <div className=\"col-auto\">\n            <input\n              type=\"text\"\n              name=\"nombre\"\n              onChange={handleInput}\n              className=\"form-control fs-5 busqueda\"\n              placeholder=\"voluntari@s\"\n            />\n          </div>\n          <div className=\"col-auto\">\n            <button className=\"btn btn-secondary fs-5\" type=\"submit\">\n              Buscar\n            </button>\n          </div>\n        </form>\n\n        <div className=\"col-auto\">\n          <select onChange={handleChange} className=\"form-select fs-5\">\n            <option>Filtrar por estado</option>\n            <option value=\"completadas\">Completadas</option>\n            <option value=\"pendientes\">Pendientes</option>\n            <option value=\"todas\">Todas</option>\n          </select>\n        </div>\n      </div>\n      <div className=\"table\">\n        <Table\n          bordered\n          dataSource={dataSource}\n          columns={columns}\n          pagination={true}\n        />\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}